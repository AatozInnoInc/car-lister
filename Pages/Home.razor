@page "/"

@using Microsoft.AspNetCore.Components.Authorization
@using car_lister.Services

@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime

<PageTitle>Car Lister - Find Your Perfect Ride</PageTitle>
<link href="css/home.css" rel="stylesheet" />

<div class="home-container">
    <AuthorizeView>
        <Authorized>
            <div class="dashboard">
                <div class="welcome-section">
                    <div class="hero-content">
                        <img src="images/Cow in Space with Flaming CRT.png" alt="Car Lister Logo" class="hero-logo" />
                        <h1>Welcome Back, <span class="user-name">@(GetUserName())</span>!</h1>
                        <p class="subtitle">Your personal car marketplace</p>
                    </div>
                </div>

                <div class="quick-actions">
                    <div class="action-card">
                        <span class="oi oi-plus action-icon"></span>
                        <h3>List Your Car</h3>
                        <p>Sell your vehicle quickly and easily</p>
                        <button class="btn btn-primary" @onclick="NavigateToAddListing">Get Started</button>
                    </div>
                    <div class="action-card">
                        <span class="oi oi-search action-icon"></span>
                        <h3>Browse Cars</h3>
                        <p>Find your perfect ride from thousands of listings</p>
                        <button class="btn btn-secondary">Browse Now</button>
                    </div>
                    <div class="action-card">
                        <span class="oi oi-heart action-icon"></span>
                        <h3>Saved Listings</h3>
                        <p>View your favorite cars</p>
                        <button class="btn btn-outline">View Saved</button>
                    </div>
                </div>
            </div>
        </Authorized>
        <NotAuthorized>
            <div class="landing-page">
                <div class="hero-section">
                    <img src="images/Cow in Space with Flaming CRT.png" alt="Car Lister Logo" class="hero-logo" />
                    <h1>Car Lister</h1>
                    <p class="tagline">Find your perfect ride or sell your car with ease</p>
                    <button class="btn btn-primary get-started" @onclick="NavigateToLogin">Get Started</button>
                </div>

                <div class="features-section">
                    <h2>Why Choose Car Lister?</h2>
                    <div class="features-grid">
                        <div class="feature-card">
                            <span class="oi oi-search feature-icon"></span>
                            <h3>Easy Search</h3>
                            <p>Find exactly what you're looking for with advanced filters</p>
                        </div>
                        <div class="feature-card">
                            <span class="oi oi-shield feature-icon"></span>
                            <h3>Secure Transactions</h3>
                            <p>Safe and secure car buying and selling experience</p>
                        </div>
                        <div class="feature-card">
                            <span class="oi oi-phone feature-icon"></span>
                            <h3>Direct Contact</h3>
                            <p>Connect directly with buyers and sellers</p>
                        </div>
                        <div class="feature-card">
                            <span class="oi oi-star feature-icon"></span>
                            <h3>Verified Listings</h3>
                            <p>All listings are verified for your peace of mind</p>
                        </div>
                    </div>
                </div>
            </div>
        </NotAuthorized>
    </AuthorizeView>
</div>

@code {
    private string GetUserName()
    {
        try
        {
            var user = JSRuntime.InvokeAsync<IDictionary<string, object>>("firebaseAuth.getCurrentUser").Result;
            if (user != null && user.ContainsKey("displayName") && user["displayName"] != null)
            {
                return user["displayName"].ToString();
            }
            else if (user != null && user.ContainsKey("email"))
            {
                return user["email"].ToString().Split('@')[0];
            }
            return "User";
        }
        catch
        {
            return "User";
        }
    }

    private void NavigateToLogin()
    {
        NavigationManager.NavigateTo("/login");
    }

    private void NavigateToAddListing()
    {
        NavigationManager.NavigateTo("/add-listing");
    }
}
